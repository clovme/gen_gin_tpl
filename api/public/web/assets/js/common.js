const utils={toast:{newToast:()=>{let t,o,e,s,a,r,i,n,p;const l=function(e,s){if(this.defaults={template:null,style:"info",autoclose:3e3,position:"top-center",icon:!0,group:"toast-message-group",onOpen:!1,onClose:!1},p="toast-pop--head-style",o=m(this.defaults,d.defaults),"string"==typeof e||"string"==typeof s)t={template:e,style:s||o.style};else{if("object"!=typeof e)return console.error("Invalid arguments."),!1;t=e}this.opt=m(o,t),c(`toast-pop--${this.opt.group}`)&&this.remove(c("toast-pop--"+this.opt.group)),this.open()};function c(t,o){return"string"==typeof t?(o||document).getElementById(t):t||null}function m(t,o){for(const e in o)o.hasOwnProperty(e)&&(t[e]=o[e]);return t}l.prototype.create=function(t){const o=document.head||document.querySelector("head");if(!c(p)){const t=document.createElement("style");t.id=p,t.innerHTML='@charset "UTF-8";.toast-pop-container{z-index:9999;position:fixed}.toast-pop-container,.toast-pop-container *,.toast-pop-container :after,.toast-pop-container :before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.toast-pop--top-left{top:0;left:0}.toast-pop--top-left .toast-pop{-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0}.toast-pop--top-center{top:0;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%)}.toast-pop--top-center .toast-pop{-webkit-transform-origin:50% 0;-ms-transform-origin:50% 0;transform-origin:50% 0}.toast-pop--top-right{top:0;right:0}.toast-pop--top-right .toast-pop{-webkit-transform-origin:100% 0;-ms-transform-origin:100% 0;transform-origin:100% 0}.toast-pop--center{top:50%;left:50%;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0)}.toast-pop--center .toast-pop{-webkit-transform-origin:50% 0;-ms-transform-origin:50% 0;transform-origin:50% 0}.toast-pop--bottom-left{bottom:0;left:0}.toast-pop--bottom-left .toast-pop{-webkit-transform-origin:0 100%;-ms-transform-origin:0 100%;transform-origin:0 100%}.toast-pop--bottom-center{bottom:0;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%)}.toast-pop--bottom-center .toast-pop{-webkit-transform-origin:50% 100%;-ms-transform-origin:50% 100%;transform-origin:50% 100%}.toast-pop--bottom-right{bottom:0;right:0}.toast-pop--bottom-right .toast-pop{-webkit-transform-origin:100% 100%;-ms-transform-origin:100% 100%;transform-origin:100% 100%}@media screen and (max-width:30em){.toast-pop--bottom-center,.toast-pop--bottom-left,.toast-pop--bottom-right,.toast-pop--top-center,.toast-pop--top-left,.toast-pop--top-right{top:auto;bottom:0;left:0;right:0;margin-left:0;-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}.toast-pop--bottom-center .toast-pop,.toast-pop--bottom-left .toast-pop,.toast-pop--bottom-right .toast-pop,.toast-pop--top-center .toast-pop,.toast-pop--top-left .toast-pop,.toast-pop--top-right .toast-pop{-webkit-transform-origin:50% 100%;-ms-transform-origin:50% 100%;transform-origin:50% 100%}.toast-pop{border-bottom:1px solid rgba(0,0,0,.15)}}.toast-pop{font-size:14px;-webkit-transform:translateZ(0);transform:translateZ(0);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}@media screen and (min-width:30em){.toast-pop{border-radius:2px;margin:.7em}}.toast-pop--error,.toast-pop--info,.toast-pop--success,.toast-pop--warning{color:#fff;background-color:#454a56}@-webkit-keyframes a{0%{-webkit-transform:scale(.2);transform:scale(.2)}95%{-webkit-transform:scale(1.1);transform:scale(1.1)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes a{0%{-webkit-transform:scale(.2);transform:scale(.2)}95%{-webkit-transform:scale(1.1);transform:scale(1.1)}to{-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes b{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}20%{-webkit-transform:scale(1.1);transform:scale(1.1)}to{opacity:0;-webkit-transform:scale(0);transform:scale(0)}}@keyframes b{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}20%{-webkit-transform:scale(1.1);transform:scale(1.1)}to{opacity:0;-webkit-transform:scale(0);transform:scale(0)}}.toast-pop--out{-webkit-animation:b .4s ease-in-out;animation:b .4s ease-in-out}.toast--in{-webkit-animation:a .4s ease-in-out;animation:a .4s ease-in-out}.toast-pop-body{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;padding-top:1px}.toast-pop-body p{margin:0}.toast-pop-body a{color:#fff;text-decoration:underline}.toast-pop-body a:hover{color:hsla(0,0%,100%,.8);text-decoration:none}.toast-pop-title{margin-top:0;margin-bottom:.25em;color:#fff}.toast-pop-close{height:32px;width:32px;padding-top:7px;padding-right:1px;font-size:22px;font-weight:700;text-align:center;line-height:.8;color:#fff;opacity:.5}.toast-pop-close:hover{opacity:.7;cursor:pointer}.toast-pop-icon{position:relative;margin:7px;width:30px;height:30px;border-radius:50%;-webkit-animation:a .4s .4s ease-in-out;animation:a .4s .4s ease-in-out}.toast-pop-icon:after,.toast-pop-icon:before{content:"";position:absolute;display:block}.toast-pop-icon--error,.toast-pop-icon--info{border:2px solid #3a95ed}.toast-pop-icon--error:before,.toast-pop-icon--info:before{top:5px;left:11px;width:4px;height:4px;background-color:#3a95ed}.toast-pop-icon--error:after,.toast-pop-icon--info:after{top:12px;left:11px;width:4px;height:9px;background-color:#3a95ed}.toast-pop-icon--error{border-color:#ff5656}.toast-pop-icon--error:before{top:16px;background-color:#ff5656}.toast-pop-icon--error:after{top:5px;background-color:#ff5656}.toast-pop-icon--success{border:2px solid #2ecc54}.toast-pop-icon--success:before{top:7px;left:7px;width:13px;height:8px;border-bottom:3px solid #2ecc54;border-left:3px solid #2ecc54;-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg)}.toast-pop-icon--warning{border:2px solid #fcd000}.toast-pop-icon--warning:before{top:7px;left:7px;width:0;height:0;border-style:solid;border-color:transparent transparent #fcd000;border-width:0 6px 10px}',o.appendChild(t)}e=c(this.getPosition("toast-pop--",this.opt.position)),s=this.opt.icon?`<i class="toast-pop-icon ${this.getStyle("toast-pop-icon--",this.opt.style)}"></i>`:"",a=`${s}<div class="toast-pop-body">${t}</div><div class="toast-pop-close" data-pop-toast="close" aria-label="Close">&times;</div>`,e||(this.popContainer=document.createElement("div"),this.popContainer.setAttribute("class",`toast-pop-container ${this.getPosition("toast-pop--",this.opt.position)}`),this.popContainer.setAttribute("id",this.getPosition("toast-pop--",this.opt.position)),document.body.appendChild(this.popContainer),e=c(this.getPosition("toast-pop--",this.opt.position))),this.pop=document.createElement("div"),this.pop.setAttribute("class",`toast-pop toast-pop--out toast--in ${this.getStyle("toast-pop--",this.opt.style)}`),this.opt.group&&"string"==typeof this.opt.group&&this.pop.setAttribute("id","toast-pop--"+this.opt.group),this.pop.setAttribute("role","alert"),this.pop.innerHTML=a,e.appendChild(this.pop)},l.prototype.getStyle=function(t,o){return r={success:"success",error:"error",warning:"warning"},t+(r[o]||"info")},l.prototype.getPosition=function(t,o){return i={"top-left":"top-left","top-center":"top-center","top-right":"top-right","bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right"},t+(i[o]||"top-right")},l.prototype.open=function(){this.create(this.opt.template),this.opt.onOpen&&this.opt.onOpen(),this.close()},l.prototype.close=function(){this.opt.autoclose&&"number"==typeof this.opt.autoclose&&(this.autocloseTimer=setTimeout(this.remove.bind(this,this.pop),this.opt.autoclose)),this.pop.addEventListener("click",this.addListeners.bind(this),!1)},l.prototype.addListeners=function(t){n=t.target.getAttribute("data-pop-toast"),"close"===n&&(this.autocloseTimer&&clearTimeout(this.autocloseTimer),this.remove(this.pop))},l.prototype.remove=function(t){const o=this;var e,s;this.opt.onClose&&this.opt.onClose(),s="toast--in",(e=t).classList?e.classList.remove(s):e.className=e.className.replace(new RegExp("(^|\\b)"+s.split(" ").join("|")+"(\\b|$)","gi")," "),setTimeout((function(){document.body.contains(t)&&t.parentNode.removeChild(t);const e=c(p),s=c(o.getPosition("toast-pop--",o.opt.position));s.childNodes.length<=0&&(s.remove(),e&&e.remove())}),390)};const d=function(t,o){return!(!t||!window.addEventListener)&&new l(t,o)};window.toast={msg:d,error:function(t){d(t,"error")},warning:function(t){d(t,"warning")},success:function(t){d(t,"success")}}},createTippy:(t,o="")=>{const e=document.querySelector(`[data-validate="${t}"]`);return e._tippy||tippy(e,{content:o,trigger:"manual",placement:"right",animation:"scale",hideOnClick:!1,interactive:!0}),e._tippy.setContent(o),e._tippy}},currentTime:async(t="second")=>(await axios.get("/public/time")).data[t],storage:{set:(t,o=null)=>{o?localStorage.setItem(`${clientId}-${o}`,t):localStorage.setItem(clientId,t)},get:(t=null)=>t?localStorage.getItem(`${clientId}-${t}`):localStorage.getItem(clientId),remove:(t=null)=>{t&&localStorage.removeItem(`${clientId}-${t}`),localStorage.removeItem(clientId)}},validateForm:(t,o,e)=>{const s=document.querySelector(t),a=t=>{if("hidden"===t.getAttribute("type"))return!0;const o=t.getAttribute("name");if(!o||!e[o])return!0;const a=e[o](t.value,s),r=utils.toast.createTippy(o,"");return a?(r.setContent(a),r.show(),t.classList.add("is-invalid"),t.classList.remove("is-valid"),!1):t.checkValidity()?(r.hide(),t.classList.remove("is-invalid"),t.classList.add("is-valid"),!0):(r.hide(),t.classList.add("is-invalid"),t.classList.remove("is-valid"),!0)};s.querySelectorAll("[name]").forEach((t=>{t.addEventListener("input",(()=>{a(t)}))})),s.querySelector('button[data-type="submit"]').addEventListener("click",(()=>{let t=!1;s.querySelectorAll("[name]").forEach((o=>{a(o)||(t=!0)})),t||(o(s),s.classList.add("was-validated"))}))},onSwitchCaptcha:()=>{const t=document.querySelector('div[data-validate="captcha"]'),o=document.querySelector("img");t.querySelector("input").value="",o.src="/public/captcha.png?t="+(new Date).getTime()},applySystemTheme:()=>{const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-bs-theme",t)}},eventListener={addLoadEventListener:t=>{window.addEventListener("load",t)},globalEmailValidateSend:(t,o,e)=>{const s=document.querySelector(t),a=document.querySelector(o),r=document.querySelector(e);function i(t,o=0){return t-o}async function n(t){const o=utils.storage.get("time");if(!o)return void utils.storage.remove("form");t||(t=await utils.currentTime());let e=parseInt(o,10);if(isNaN(e)||e<0)return utils.storage.remove("time"),void utils.storage.remove("form");const r=utils.storage.get("form");if(r)Object.entries(JSON.parse(r)).forEach((([t,o])=>{a.elements[t].value=o}));else{let t=new FormData(a),o={};t.forEach(((t,e)=>{o[e]=t})),utils.storage.set(JSON.stringify(o),"form")}s.setAttribute("disabled","disabled"),s.innerHTML=`发送验证码(<i>${i(e-t)}</i>s)`;let n=setInterval((()=>{if(i(e-t)<=0)return clearInterval(n),s.innerHTML="重新发送验证码",s.removeAttribute("disabled"),utils.storage.remove("time"),void utils.storage.remove("form");s.setAttribute("disabled","disabled"),s.innerHTML=`发送验证码(<i>${i(e-t)}</i>s)`,t++}),1e3)}n(),s.addEventListener("click",(function(){if(!/^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$/.test(r.value))return void toast.error("请输入正确的邮箱地址！");const t={email:r.value};axios.post("/public/email/code",t).then((async t=>{const o=await utils.currentTime();toast.success(t.message),utils.storage.set((o+60).toString(),"time"),await n(o)}))}))},globalOnSwitchCaptcha:t=>{document.querySelector(t).addEventListener("click",(function(){utils.onSwitchCaptcha()}))},userRegeditForm:()=>{utils.validateForm(".float-form",(t=>{axios.post(t.action,new FormData(t)).then((t=>{utils.storage.remove("time"),utils.storage.remove("form"),toast.success(t.message);const o=setTimeout((()=>{location.reload(),clearTimeout(o)}),2e3)})).catch((o=>{for(let e in o.data){"hidden"!==t.elements[e].getAttribute("type")&&utils.toast.createTippy(e,o.data[e]).show()}document.querySelector('input[name="email_code"]').value="",utils.onSwitchCaptcha()}))}),{username:t=>{if(!t)return"用户名不能为空";return/^[a-zA-Z0-9]{5,20}$/.test(t)?null:"请输入5-20位的字母、数字作为用户名"},email:t=>{if(!t)return"邮箱不能为空";return/^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$/.test(t)?null:"请输入有效的邮箱地址"},email_code:t=>t?null:"邮箱验证码不能为空",password:t=>{if(!t)return"密码不能为空";if(t.length<6||t.length>20)return"密码必须包含字母、数字和特殊字符，长度6-20";const o=/[A-Za-z]/.test(t),e=/\d/.test(t),s=/[^A-Za-z\d]/.test(t);return o&&e&&s?null:"密码必须包含字母、数字和特殊字符，长度6-20"},confirm_password:(t,o)=>{const e=o.querySelector('[name="password"]').value;return t?t!==e?"两次输入的密码不一致":null:"确认密码不能为空"},captcha:t=>t?null:"验证码不能为空"})},userLoginForm:()=>{utils.validateForm(".float-form",(t=>{axios.post(t.action,new FormData(t)).then((t=>{toast.success(t.message);const o=setTimeout((()=>{location.reload(),clearTimeout(o)}),2e3)})).catch((o=>{for(let e in o.data){"hidden"!==t.elements[e].getAttribute("type")&&utils.toast.createTippy(e,o.data[e]).show()}utils.onSwitchCaptcha()}))}),{username:t=>t?null:"用户名不能为空",password:t=>t?null:"密码不能为空",captcha:t=>t?null:"验证码不能为空"})}};eventListener.addLoadEventListener((()=>{utils.toast.newToast(),utils.applySystemTheme(),matchMedia("(prefers-color-scheme: dark)").addEventListener("change",utils.applySystemTheme)}));