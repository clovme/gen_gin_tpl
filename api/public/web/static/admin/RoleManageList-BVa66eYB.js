import{d as R,a as _,r as k,b as r,V as s,c as l,i as f,o as g,w as v,g as w,m as y,t as P,D as A,z as V}from"./index-Cvc_Iv1t.js";import{p as M,a as L,d as I}from"./role-Cm4bIvEG.js";import{g as S}from"./permissions-FOMy8IFo.js";const E=R({__name:"RoleManageList",setup(D){const o=_(),d=k(),c=o.userRoleLevel+1,h=r({name:"VxeNumberInput",defaultValue:c,props:{min:c,max:999}}),m=r({name:"VxeTreeSelect",options:[],optionProps:{value:"code",label:"name"},props:{multiple:!0,treeConfig:{transform:!0,keyField:"code",parentField:"parentCode",showCheckbox:!0}}}),u=r({name:"VxeTreeSelect",options:[],optionProps:{value:"code",label:"name"},props:{multiple:!0,clearable:!0,treeConfig:{transform:!0,keyField:"code",parentField:"parentCode",showCheckbox:!0,checkboxConfig:{checkStrictly:!0}}}});S({}).then(e=>{m.options=e.data,u.options=e.data});const C=r({id:"RoleManageList",height:"100%",keepSource:!0,showOverflow:!0,rowConfig:{isHover:!0},customConfig:{storage:!0},sortConfig:{remote:!0,multiple:!0},editConfig:{mode:"row",showStatus:!0,enabled:s.permission.checkVisible("roleManageActionInsert|roleManageActionUpdate"),beforeEditMethod({row:e}){return o.userRoleLevel<e.level}},checkboxConfig:{checkMethod({row:e}){return o.userRoleLevel<e.level}},toolbarConfig:{refresh:!0,zoom:!0,buttons:[{name:"新增",code:"insert_edit",status:"primary",icon:"vxe-icon-add",permissionCode:"roleManageActionInsert"},{name:"标记/删除",code:"mark_cancel",status:"error",icon:"vxe-icon-delete",permissionCode:"roleManageActionDelete"},{name:"保存",code:"save",status:"success",icon:"vxe-icon-save",permissionCode:"roleManageActionInsert|roleManageActionDelete|roleManageActionUpdate"}]},editRules:{name:[{required:!0,message:"请输入角色名称"}]},formConfig:{items:[{field:"name",title:"角色名称",span:6,itemRender:{name:"VxeInput",props:{clearable:!0}}},{field:"permissionsCodes",title:"关联权限",span:6,itemRender:u},{itemRender:{name:"ListSearchBtn"}}]},pagerConfig:{},columns:[{type:"checkbox",width:60},{type:"seq",width:70},{field:"code",title:"角色编码",width:300,visible:!1},{field:"name",title:"角色名称",minWidth:200,sortable:!0,editRender:{name:"VxeInput"}},{field:"level",title:"权重",width:120,sortable:!0,editRender:h,titlePrefix:{icon:"vxe-icon-question-circle-fill",content:"角色权重说明：数值越低权限越高，高权重的角色可以修改低权重的数据。"}},{field:"permissionsCodes",title:"关联权限",minWidth:500,editRender:m},{field:"remark",title:"备注",minWidth:300},{field:"updateTime",title:"最后更新时间",width:160,formatter:"FormatDateTime",sortable:!0},{field:"createTime",title:"创建时间",width:160,formatter:"FormatDateTime",sortable:!0},{field:"action",title:"操作",fixed:"right",width:80,slots:{default:"action"}}],proxyConfig:{sort:!0,form:!0,ajax:{query({page:e,form:t,sorts:i}){const a={...e,...t,permissionsCodes:t.permissionsCodes?t.permissionsCodes.join(","):"",orderBy:i.map(n=>`${n.field}|${n.order}`).join(",")};return L(a)},save({body:e}){return M(e)}}}}),x=async e=>{const t=d.value;if(t&&t.isInsertByRow(e)){t.remove(e);return}await s.modal.confirm({content:`请确认是否删除 “ ${e.name} ”？`})==="confirm"&&I({_id:e._id}).then(()=>{t&&t.commitProxy("query"),s.modal.message({content:"删除成功",status:"success"})})},b={editDisabled(){s.modal.message({id:"noPermissionEdit",content:"无法编辑，权限不够！",status:"warning"})}};return(e,t)=>{const i=l("vxe-button"),a=l("vxe-grid"),n=l("PageView");return g(),f(n,null,{default:v(()=>[w(a,y({ref_key:"gridRef",ref:d},C,P(b)),{action:v(({row:p})=>[V(o).userRoleLevel<p.level?(g(),f(i,{key:0,mode:"text",status:"error",icon:"vxe-icon-delete","permission-code":"roleManageActionDelete",onClick:B=>x(p)},null,8,["onClick"])):A("",!0)]),_:1},16)]),_:1})}}});export{E as default};
