import{d as I,a as L,r as P,b as a,V as s,B as w,C as D,c as n,i as h,o as C,w as i,g as l,m as S,t as B,D as E,z as p,h as b,E as N}from"./index-Cvc_Iv1t.js";import{g as q}from"./role-Cm4bIvEG.js";const j=I({__name:"UserManageList",setup(T){const r=L(),f=P(),g=a({name:"VxeSelect",options:[],defaultValue:"default",props:{disabled:!0}}),x=a({name:"VxeSelect",props:{multiple:!0},options:[],defaultValue:["default"],events:{change({row:e}){e.roleCodes.includes(e.roleCode)||(e.roleCode=e.roleCodes[0])}}}),v=a({name:"VxeSelect",props:{clearable:!0},options:[]}),_=a({name:"VxeSelect",props:{multiple:!0,clearable:!0},options:[]}),V=a({id:"UserManageList",height:"100%",keepSource:!0,showOverflow:!0,customConfig:{storage:!0},rowConfig:{isHover:!0,keyField:"_id"},sortConfig:{remote:!0,multiple:!0},editConfig:{mode:"row",showStatus:!0,enabled:s.permission.checkVisible("userManageActionInsert|userManageActionUpdate"),beforeEditMethod({row:e,column:t}){return!(r.userRoleLevel>=e.roleLevel||e.code&&t.field==="name")}},checkboxConfig:{checkMethod({row:e}){return r.userRoleLevel<e.roleLevel}},toolbarConfig:{refresh:!0,zoom:!0,buttons:[{name:"新增",code:"insert_edit",status:"primary",icon:"vxe-icon-add",permissionCode:"userManageActionInsert"},{name:"标记/删除",code:"mark_cancel",status:"error",icon:"vxe-icon-delete",permissionCode:"userManageActionDelete"},{name:"保存",code:"save",status:"success",icon:"vxe-icon-save",permissionCode:"userManageActionInsert|userManageActionDelete|userManageActionUpdate"}]},editRules:{name:[{required:!0,message:"请输入用户名"}],roleCodes:[{required:!0,type:"array",message:"至少需要授权一个角色"}]},formConfig:{titleWidth:80,titleAlign:"right",items:[{field:"name",title:"用户名",span:6,itemRender:{name:"VxeInput",props:{clearable:!0}}},{field:"nickname",title:"昵称",span:6,itemRender:{name:"VxeInput",props:{clearable:!0}}},{field:"email",title:"邮箱",span:6,itemRender:{name:"VxeInput",props:{clearable:!0}}},{field:"roleCodes",title:"关联角色",span:6,itemRender:_},{field:"roleCode",title:"默认角色",span:6,folding:!0,itemRender:v},{field:"startDate",title:"开始时间",span:6,folding:!0,itemRender:{name:"VxeDatePicker",props:{clearable:!0}}},{field:"endDate",title:"结束时间",span:6,folding:!0,itemRender:{name:"VxeDatePicker",props:{clearable:!0}}},{span:24,align:"center",collapseNode:!0,itemRender:{name:"ListSearchBtn"}}]},pagerConfig:{},columns:[{type:"checkbox",width:60},{type:"seq",width:70},{field:"code",title:"用户编码",width:300,visible:!1},{field:"name",title:"用户名",minWidth:160,sortable:!0,editRender:{name:"VxeInput"},slots:{edit:"editName"}},{field:"roleCodes",title:"关联角色",minWidth:300,editRender:x},{field:"roleCode",title:"默认角色",width:140,editRender:g},{field:"nickname",title:"昵称",minWidth:220,editRender:{name:"VxeInput"}},{field:"pictureUrl",title:"头像",width:120,slots:{default:"defaultPictureUrl"}},{field:"email",title:"邮箱",minWidth:220,editRender:{name:"VxeInput"}},{field:"createTime",title:"注册时间",width:160,formatter:"FormatDateTime",sortable:!0},{field:"updateTime",title:"最后更新时间",width:160,formatter:"FormatDateTime",sortable:!0},{field:"action",title:"操作",fixed:"right",width:80,slots:{default:"action"}}],proxyConfig:{sort:!0,form:!0,ajax:{query({page:e,form:t,sorts:d}){const m={...e,...t,roleCodes:t.roleCodes?t.roleCodes.join(","):"",orderBy:d.map(u=>`${u.field}|${u.order}`).join(",")};return D(m)},save({body:e}){return w(e)}}}}),R=async e=>{const t=f.value;if(t&&t.isInsertByRow(e)){t.remove(e);return}await s.modal.confirm({content:`请确认是否删除 “ ${e.name} ”？`})==="confirm"&&N({_id:e._id}).then(()=>{t&&t.commitProxy("query"),s.modal.message({content:"删除成功",status:"success"})})},y={editDisabled({row:e}){r.userRoleLevel>=e.roleLevel&&s.modal.message({id:"noPermissionEdit",content:"无法编辑，权限不够！",status:"warning"})}};return q().then(e=>{g.options=e.data,x.options=e.data,v.options=e.data,_.options=e.data}),(e,t)=>{const d=n("vxe-text"),m=n("vxe-tip"),u=n("vxe-input"),U=n("VxeUpload"),k=n("vxe-button"),M=n("vxe-grid"),A=n("PageView");return C(),h(A,null,{default:i(()=>[l(M,S({ref_key:"gridRef",ref:f},V,B(y)),{top:i(()=>[l(m,{status:"error",icon:"vxe-icon-warning-circle-fill","permission-code":"userManageActionInsert"},{default:i(()=>[t[1]||(t[1]=b("新增用户的初始密码为：",-1)),l(d,{"click-to-copy":""},{default:i(()=>t[0]||(t[0]=[b("123456",-1)])),_:1,__:[0]})]),_:1,__:[1]})]),editName:i(({row:o})=>[l(u,{modelValue:o.name,"onUpdate:modelValue":c=>o.name=c,disabled:!!o.code},null,8,["modelValue","onUpdate:modelValue","disabled"])]),defaultPictureUrl:i(({row:o})=>[l(U,{singleMode:"",urlMode:"",modelValue:o.pictureUrl,"onUpdate:modelValue":c=>o.pictureUrl=c,"show-button-text":!1,"show-remove-button":!1,imageStyle:{width:40,height:40},readonly:p(r).userRoleLevel>=o.roleLevel||!p(s).permission.checkVisible("userManageActionInsert|userManageActionUpdate"),mode:"image","button-icon":"vxe-icon-edit"},null,8,["modelValue","onUpdate:modelValue","readonly"])]),action:i(({row:o})=>[p(r).userRoleLevel<o.roleLevel?(C(),h(k,{key:0,mode:"text",status:"error",icon:"vxe-icon-delete","permission-code":"userManageActionDelete",onClick:c=>R(o)},null,8,["onClick"])):E("",!0)]),_:1},16)]),_:1})}}});export{j as default};
