import{d as w,r as R,X as _,F as b,b as n,V as a,c as r,i as y,o as V,w as l,g as d,m as k}from"./index-Cvc_Iv1t.js";import{p as A,g as M,d as I}from"./route-B_K32uly.js";const S=w({__name:"RouteManageList",setup(P){const i=R(),s=[{value:"",label:"-"}];_.eachTree(b,e=>{e.name&&e.component&&s.push({label:e.name,value:e.name})});const c=n({name:"VxeTreeSelect",options:[],optionProps:{value:"code",label:"name"},props:{clearable:!0,treeConfig:{transform:!0,keyField:"code",parentField:"parentCode",showRadio:!0}}}),m=n({name:"VxeSelect",defaultValue:"",options:s}),p=n({name:"VxeSelect",defaultValue:"menu",options:[{value:"menu",label:"菜单"},{value:"action",label:"行为"}]}),f=n({id:"RouteManageList",height:"100%",keepSource:!0,showOverflow:!0,rowConfig:{isHover:!0,keyField:"_id"},treeConfig:{transform:!0,rowField:"code",parentField:"parentCode",expandAll:!0,reserve:!0},editConfig:{mode:"row",showStatus:!0,enabled:a.permission.checkVisible("routeManageActionInsert|routeManageActionUpdate")},customConfig:{storage:!0},toolbarConfig:{refresh:!0,zoom:!0,buttons:[{name:"新增",code:"insert_edit",status:"primary",icon:"vxe-icon-add",permissionCode:"routeManageActionInsert"},{name:"标记/删除",code:"mark_cancel",status:"error",icon:"vxe-icon-delete",permissionCode:"routeManageActionDelete"},{name:"保存",code:"save",status:"success",icon:"vxe-icon-save",permissionCode:"routeManageActionInsert|routeManageActionDelete|routeManageActionUpdate"}]},editRules:{type:[{required:!0,message:"请选择路由类型"}],name:[{required:!0,message:"请输入路由名称"}],parentCode:[{validator({row:e}){if(e.parentCode&&e.parentCode===e.code)return new Error("父级不能是自己")}}]},columns:[{type:"checkbox",width:60},{type:"seq",width:70},{field:"name",title:"路由名称",treeNode:!0,minWidth:300,editRender:{name:"VxeInput"}},{field:"parentCode",title:"关联父级",width:200,editRender:c},{field:"routeName",title:"关联组件",width:260,editRender:m},{field:"type",title:"路由类型",width:120,editRender:p},{field:"code",title:"路由编码",width:200,editRender:{name:"VxeInput"}},{field:"icon",title:"菜单图标",width:120,editRender:{name:"VxeIconPicker"}},{field:"sort",title:"排序",width:100,editRender:{name:"VxeNumberInput"}},{field:"updateTime",title:"最后更新时间",width:160,formatter:"FormatDateTime"},{field:"createTime",title:"创建时间",width:160,formatter:"FormatDateTime"},{field:"action",title:"操作",fixed:"right",width:100,slots:{default:"action"}}],proxyConfig:{ajax:{query({page:e}){const t={...e};return M(t).then(o=>(c.options=o.data,o))},save({body:e}){return A(e)}}}}),g=async e=>{const t=i.value;if(t){const{row:o}=await t.insert({name:"",parentCode:e.code});t.setEditRow(o),t.setTreeExpand(e,!0)}},v=async e=>{const t=i.value;if(t&&t.isInsertByRow(e)){t.remove(e);return}await a.modal.confirm({content:`请确认是否删除 “ ${e.name} ”？`})==="confirm"&&I({_id:e._id}).then(()=>{t&&t.commitProxy("query"),a.modal.message({content:"删除成功",status:"success"})})};return(e,t)=>{const o=r("vxe-button"),x=r("vxe-grid"),h=r("PageView");return V(),y(h,null,{default:l(()=>[d(x,k({ref_key:"gridRef",ref:i},f),{action:l(({row:u})=>[d(o,{mode:"text",status:"primary",icon:"vxe-icon-add-sub","permission-code":"routeManageActionInsert",onClick:C=>g(u)},null,8,["onClick"]),d(o,{mode:"text",status:"error",icon:"vxe-icon-delete","permission-code":"routeManageActionDelete",onClick:C=>v(u)},null,8,["onClick"])]),_:1},16)]),_:1})}}});export{S as default};
